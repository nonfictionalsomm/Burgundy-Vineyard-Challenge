<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Burgundy Gambit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f3ef; /* A warm, paper-like background */
        }
        .title-font {
            font-family: 'Lora', serif;
        }
        .btn-option {
            transition: all 0.2s ease-in-out;
        }
        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .correct {
            background-color: #22c55e !important; /* green-500 */
            color: white;
            border-color: #16a34a;
        }
        .incorrect {
            background-color: #ef4444 !important; /* red-500 */
            color: white;
            border-color: #dc2626;
        }
        .hidden {
            display: none;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 40;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            z-index: 50;
            opacity: 0;
            transition: all 0.3s ease-in-out;
            pointer-events: none;
        }
        .modal-container.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Welcome Modal -->
    <div id="modal-overlay" class="modal-overlay"></div>
    <div id="welcome-modal" class="modal-container w-full max-w-lg">
        <div class="bg-white rounded-2xl shadow-xl p-8 text-center">
            <h2 class="text-4xl font-bold text-gray-800 title-font mb-4">The Burgundy Gambit</h2>
            <p class="text-gray-600 mb-2">Welcome, wine adventurer!</p>
            <p class="text-gray-600 mb-4">We'll show you three famous Burgundian vineyards (*climats*). Your task is to identify the correct village appellation where they are located. The challenge covers vineyards from Chablis to Beaujolais.</p>
            <p class="text-gray-600 mb-6">The path to mastery is paved with practice. Play again and again to sharpen your knowledge and become a true Burgundy legend!</p>
            <div class="flex flex-col sm:flex-row gap-4">
                 <button id="study-button" class="w-full bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors duration-200">
                    Study First?
                </button>
                <button id="start-game-button" class="w-full bg-red-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-900 transition-colors duration-200 shadow-md">
                    Begin the Challenge
                </button>
            </div>
        </div>
    </div>
    
    <!-- Study Modal -->
    <div id="study-modal-overlay" class="modal-overlay"></div>
    <div id="study-modal" class="modal-container w-full max-w-3xl">
        <div class="bg-white rounded-2xl shadow-xl p-8 flex flex-col" style="max-height: 80vh;">
            <div class="flex-shrink-0 text-center mb-4">
                <h2 class="text-3xl font-bold text-gray-800 title-font mb-1">Vineyard Database</h2>
                <p class="text-sm text-gray-500 italic">(listed from north to south)</p>
            </div>
            <div id="study-content" class="flex-grow overflow-y-auto pr-4">
                <!-- Data will be injected here -->
            </div>
            <div class="flex-shrink-0 mt-6 text-center">
                <button id="close-study-button" class="bg-red-800 text-white font-bold py-2 px-8 rounded-lg hover:bg-red-900 transition-colors duration-200 shadow-md">
                    Close
                </button>
            </div>
        </div>
    </div>


    <!-- Answer Feedback Modal -->
    <div id="feedback-modal-overlay" class="modal-overlay"></div>
    <div id="feedback-modal" class="modal-container w-full max-w-sm">
        <div id="feedback-modal-content" class="bg-white rounded-2xl shadow-xl p-8 text-center">
            <h2 id="feedback-title" class="text-4xl font-bold title-font mb-4"></h2>
            <p id="feedback-text" class="text-gray-600 mb-6"></p>
            <button id="continue-button" class="w-full bg-red-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-900 transition-colors duration-200 shadow-md">
                Continue
            </button>
        </div>
    </div>

    <!-- Main Game Content -->
    <div id="main-content" class="relative w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-10 hidden">
        <!-- Main Menu Button -->
        <div class="absolute top-4 left-4 md:top-6 md:left-6">
            <button id="main-menu-button" class="text-gray-500 hover:text-red-800 font-semibold transition-colors duration-200 flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                </svg>
                Main Menu
            </button>
        </div>

        <div class="text-center mb-8 pt-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 title-font">The Burgundy Gambit</h1>
            <p id="subtitle" class="text-gray-600 mt-2">Which village are these vineyards located in?</p>
        </div>

        <!-- Game Area -->
        <div id="game-area">
            <div id="question-container" class="bg-red-900/5 border border-red-900/10 rounded-lg p-6 mb-8 text-center min-h-[10rem] flex items-center justify-center">
                <div id="vineyards" class="text-center"></div>
            </div>
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"></div>
        </div>
        
        <!-- Final Score Area -->
        <div id="final-score-area" class="hidden text-center py-8">
            <h2 class="text-3xl font-bold text-gray-800 title-font mb-2">Challenge Complete!</h2>
            <p class="text-5xl font-bold text-red-800 mb-4" id="final-score-display"></p>
            <p class="text-xl text-gray-700 font-semibold mb-4" id="final-percentage-display"></p>
            <p class="text-lg text-gray-600" id="final-message"></p>
            <button id="play-again-button" class="mt-6 bg-red-800 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-900 transition-colors duration-200 shadow-md">
                Play Again?
            </button>
        </div>

        <!-- Footer Info -->
        <div id="footer-info" class="flex items-center justify-between text-center mt-8">
            <div class="text-left">
                <span class="text-gray-500">Score</span>
                <p id="score" class="text-2xl font-bold text-gray-800">0</p>
            </div>
            <div>
                 <span class="text-gray-500">Round</span>
                <p id="round-counter" class="text-2xl font-bold text-gray-800">0 / 20</p>
            </div>
        </div>
    </div>

    <script>
        const vineyardData = {
            "Chablis": {
                "Grand Cru": ["Blanchot", "Bougros", "Grenouilles", "Les Clos", "Preuses", "Valmur", "Vaudésir"],
                "Premier Cru": ["Beauroy", "Berdiot", "Beugnons", "Butteaux", "Chapelot", "Chatains", "Chaume de Talvat", "Côte de Bréchain", "Côte de Cuisy", "Côte de Fontenay", "Côte de Jouan", "Côte de Léchet", "Côte de Savant", "Côte de Vaubarousse", "Côte des Prés Girots", "Forêts", "Fourchaume", "L'Homme Mort", "Les Beauregards", "Les Fourneaux", "Les Lys", "Les Épinottes", "Mont de Milieu", "Montmains", "Montée de Tonnerre", "Morein", "Mélinots", "Pied d'Aloup", "Roncières", "Sécher", "Troesmes", "Vaillons", "Vau Ligneau", "Vau de Vey", "Vaucoupin", "Vaugiraut", "Vaulorent", "Vaupulent", "Vaux Ragons", "Vosgros"]
            },
            "Fixin": {
                "Premier Cru": ["Arvelets", "Clos Napoléon", "Clos de la Perrière", "Hervelets", "Le Clos du Chapitre", "Les Meix Bas"]
            },
            "Gevrey-Chambertin": {
                "Grand Cru": ["Chambertin", "Chambertin Clos de Bèze", "Chapelle-Chambertin", "Charmes-Chambertin", "Griotte-Chambertin", "Latricières-Chambertin", "Mazis-Chambertin", "Mazoyères-Chambertin", "Ruchottes-Chambertin"],
                "Premier Cru": ["Au-Closeau", "Aux Combottes", "Bel Air", "Champonnet", "Cherbaudes", "Clos Prieur", "Clos Saint-Jacques", "Clos des Varoilles", "Clos du Chapitre", "Craipillot", "En Ergot", "Estournelles-Saint-Jacques", "Fonteny", "Issarts", "La Boissière", "La Combe-au-Moine", "La Perrière", "La Romanée", "Lavaux-Saint-Jacques", "Les Cazetiers", "Les Champeaux", "Les Corbeaux", "Les Goulots", "Les Petits-Cazetiers", "Petite-Chapelle", "Poissenot"]
            },
            "Morey-Saint-Denis": {
                "Grand Cru": ["Bonnes Mares", "Clos Saint-Denis", "Clos de La Roche", "Clos de Tart", "Clos des Lambrays"],
                "Premier Cru": ["Aux Charmes", "Aux Cheseaux", "Clos Baulet", "Clos Sorbè", "Clos des Ormes", "Côte Rotie", "La Bussière", "La Riotte", "Le Village", "Les Blanchards", "Les Chaffots", "Les Charrières", "Les Chenevery", "Les Faconnières", "Les Genavrières", "Les Gruenchers", "Les Millandes", "Les Ruchots", "Les Sorbès", "Monts Luisants"]
            },
            "Chambolle-Musigny": {
                "Grand Cru": ["Bonnes Mares", "Musigny"],
                "Premier Cru": ["Aux Beaux Bruns", "Aux Combottes", "Aux Échanges", "Derrière la Grange", "La Combe d'Orveau", "Les Amoureuses", "Les Baudes", "Les Borniques", "Les Carrières", "Les Chabiots", "Les Charmes", "Les Chatelots", "Les Cras", "Les Feusselottes/Les Feusselotes", "Les Fuées", "Les Grand Murs", "Les Groseilles", "Les Gruenchers", "Les Hauts-Doix", "Les Lavrottes", "Les Noirots", "Les Plantes", "Les Sentiers", "Les Véroilles"]
            },
            "Vougeot": {
                "Grand Cru": ["Clos de Vougeot"],
                "Premier Cru": ["Clos de la Perrière", "Le Clos Blanc", "Le Petits Vougeots", "Les Crâs"]
            },
            "Vosne-Romanée": {
                "Grand Cru": ["Echézeaux", "Grands-Echézeaux", "La Grande Rue", "La Romanée", "La Tâche", "Richebourg", "Romanée-Conti", "Romanée-Saint-Vivant"],
                "Premier Cru": ["Au-dessus des Malconsorts", "Aux Brûlées", "Aux Malconsorts", "Aux Raignots", "Clos des Réas", "Cros Parantoux", "En Orveaux", "La Croix Rameau", "Les Beaux Monts", "Les Chaumes", "Les Gaudichots", "Les Petits Monts", "Les Rouges", "Les Suchots"]
            },
            "Nuits-Saint-Georges": {
                "Premier Cru": ["Aux Argillas", "Aux Boudots", "Aux Bousselots", "Aux Chaignots", "Aux Champs Perdrix", "Aux Cras", "Aux Murgers", "Aux Perdrix", "Aux Thorey", "Aux Vignerondes", "Chaines Carteaux", "Château Gris", "Clos Arlot", "Clos Saint-Marc", "Clos de la Maréchale", "Clos des Argillières", "Clos des Corvées", "Clos des Corvées Pagets", "Clos des Forêts Saint-Georges", "Clos des Grandes Vignes", "Clos des Porrets-Saint-Georges", "En la Perrière Noblot", "La Richemone", "Les Argillières", "Les Cailles", "Les Chabœufs", "Les Crots", "Les Damodes", "Les Didiers", "Les Hauts Pruliers", "Les Perrières", "Les Porrets-Saint-Georges", "Les Poulettes", "Les Procès", "Les Pruliers", "Les Saints-Georges", "Les Terres Blanches", "Les Vallerots", "Les Vaucrains", "Roncière", "Rue de Chaux"]
            },
            "Ladoix": {
                "Grand Cru": ["Corton", "Corton-Charlemagne"],
                "Premier Cru": ["Basses Mourottes", "Bois Roussot", "En Naget", "Hautes Mourottes", "La Corvée", "La Micaude", "Le Clou d'Orge", "Le Rognet et Corton", "Les Buis", "Les Grêchons et Foutrières", "Les Joyeuses"]
            },
            "Aloxe-Corton": {
                "Grand Cru": ["Charlemagne", "Corton", "Corton-Charlemagne"],
                "Premier Cru": ["Clos des Maréchaudes", "Clos du Chapitre", "La Coutière", "La Maréchaude", "La Toppe au Vert", "Les Chaillots", "Les Fournières", "Les Guérets", "Les Moutottes", "Les Paulands", "Les Petites Lolières", "Les Valozières", "Les Vercots"]
            },
            "Pernand-Vergelesses": {
                "Grand Cru": ["Charlemagne", "Corton", "Corton-Charlemagne"],
                "Premier Cru": ["Clos Berthet", "Creux de la Net", "En Caradeux", "Ile des Vergelesses", "Les Fichots", "Sous Frétille", "Vergelesses", "Village de Pernand"]
            },
            "Savigny-Lès-Beaune": {
                "Premier Cru": ["Aux Clous", "Aux Fourneaux", "Aux Gravains", "Aux Guettes", "Aux Serpentières", "Basses Vergelesses", "Bataillière", "Champ Chevrey", "La Dominode", "Les Charnières", "Les Hauts Jarrons", "Les Hauts Marconnets", "Les Jarrons", "Les Lavières", "Les Marconnets", "Les Narbantons", "Les Peuillets", "Les Rouvrettes", "Les Talmettes", "Les Vergelesses", "Petits Godeaux", "Redrescul"]
            },
            "Beaune": {
                "Premier Cru": ["A l'Ecu", "Aux Coucherias", "Aux Cras", "Belissand", "Blanches Fleurs", "Champs Pimont", "Clos Saint-Landry", "Clos de l'Ecu", "Clos de la Feguine", "Clos de la Mousse", "Clos des Avaux", "Clos des Ursules", "Clos du Roi", "En Genêt", "En l'Orme", "La Mignotte", "Le Bas des Teurons", "Le Clos des Mouches", "Les Aigrots", "Les Avaux", "Les Boucherottes", "Les Bressandes", "Les Cents Vignes", "Les Chouacheux", "Les Epenotes", "Les Fèves", "Les Grèves", "Les Marconnets", "Les Montrevenots", "Les Perrières", "Les Reversés", "Les Sceaux", "Les Seurey", "Les Sizies", "Les Teurons", "Les Toussaints", "Les Tuvilains", "Les Vignes Franches", "Montée Rouge", "Pertuisots", "Sur les Grèves", "Sur les Grèves-Clos Sainte-Anne"]
            },
            "Pommard": {
                "Premier Cru": ["Clos Blanc", "Clos de Verger", "Clos de la Commaraine", "Clos des Epeneaux", "Derrière Saint-Jean", "En Largillière", "La Chanière", "La Platière", "La Refène", "Le Clos Micot", "Le Village", "Les Arvelets", "Les Bertins", "Les Boucherottes", "Les Chanlins-Bas", "Les Chaponnières", "Les Charmots", "Les Combes Dessus", "Les Croix Noires", "Les Fremiers", "Les Grands Epenots", "Les Jarolières", "Les Petits Epenots", "Les Poutures", "Les Pézerolles", "Les Rugiens Bas", "Les Rugiens Hauts", "Les Saussilles"]
            },
            "Volnay": {
                "Premier Cru": ["Carelle sous la Chapelle", "Champans", "Clos de l'Audignac", "Clos de la Barre", "Clos de la Bousse d'Or", "Clos de la Cave des Ducs", "Clos de la Chapelle", "Clos de la Rougeotte", "Clos des 60 Ouvrées", "Clos des Chênes", "Clos des Ducs", "Clos du Château des Ducs", "Clos du Verseuil", "En Chevret", "Frémiets", "Frémiets ― Clos de la Rougeotte", "La Gigotte", "Lassolle", "Le Ronceret", "Le Village", "Les Angles", "Les Brouillards", "Les Caillerets", "Les Lurets", "Les Mitans", "Pitures Dessus", "Robardelle", "Santenots", "Taille Pieds"]
            },
            "Monthélie": {
                "Premier Cru": ["Clos des Toisières", "La Taupine", "Le Cas Rougeot", "Le Château Gaillard", "Le Clos Gauthey", "Le Clou des Chênes", "Le Meix Bataille", "Le Village", "Les Barbières", "Les Champs Fulliots", "Les Clous", "Les Duresses", "Les Riottes", "Les Vignes Rondes", "Sur la Velle"]
            },
            "Auxey-Duresses": {
                "Premier Cru": ["Bas des Duresses", "Climat du Val", "Clos du Val", "La Chapelle", "Les Bréterins", "Les Duresses", "Les Ecussaux", "Les Grands Champs", "Reugne"]
            },
            "Meursault": {
                "Premier Cru": ["Blagny", "Charmes", "Clos des Perrières", "Genevrières", "La Jeunellotte/Genelotte", "La Pièce sous le Bois", "Le Porusot", "Les Bouchères", "Les Caillerets", "Les Cras", "Les Gouttes d'Or", "Les Plures", "Les Ravelles", "Les Santenots Blancs", "Les Santenots du Milieu", "Perrières", "Porusot", "Sous Blagny", "Sous le Dos d'Ane"]
            },
            "Blagny": {
                "Premier Cru": ["Hameau de Blagny", "La Garenne", "La Jeunellotte", "La Pièce sous le Bois", "Sous Blagny", "Sous le Dos d'Ane", "Sous le Puits"]
            },
            "Puligny-Montrachet": {
                "Grand Cru": ["Bienvenues-Bâtard-Montrachet", "Bâtard-Montrachet", "Chevalier-Montrachet", "Montrachet"],
                "Premier Cru": ["Champ Canet", "Champ Gain", "Clavaillon", "Clos de la Garenne", "Clos de la Mouchère", "Hameau de Blagny", "La Garenne", "La Truffière", "Le Cailleret", "Les Chalumaux", "Les Combettes", "Les Demoiselles", "Les Folatières", "Les Perrières", "Les Pucelles", "Les Referts", "Sous le Puits"]
            },
            "Chassagne-Montrachet": {
                "Grand Cru": ["(le) Montrachet", "Bâtard-Montrachet", "Criots-Bâtard-Montrachet"],
                "Premier Cru": ["Abbaye de Morgeot", "Blanchot Dessus", "Bois de Chassagne", "Cailleret", "Champs Jendreau", "Chassagne", "Chassagne du Clos Saint-Jean", "Clos Chareau", "Clos Pitois", "Clos Saint-Jean", "Dent de Chien", "En Cailleret", "En Remilly", "En Virondot", "Ez Crets", "Ez Crottes", "Francemont", "Guerchère", "La Boudriotte", "La Cardeuse", "La Chapelle", "La Grande Borne", "La Grande Montagne", "La Maltroie", "La Romanée", "La Roquemaure", "Les Baudines", "Les Boirettes", "Les Bondues", "Les Brussonnes", "Les Champs Gain", "Les Chaumes", "Les Chaumées", "Les Chenevottes", "Les Combards", "Les Commes", "Les Embazées", "Les Fairendes", "Les Grandes Ruchottes", "Les Grands Clos", "Les Macherelles", "Les Murées", "Les Pasquelles", "Les Petites Fairendes", "Les Petits Clos", "Les Places", "Les Rebichets", "Les Vergers", "Morgeot", "Petingeret", "Tonton Marcel", "Tête du Clos", "Vide Bourse", "Vigne Blanche", "Vigne Derrière"]
            },
            "Saint-Aubin": {
                "Premier Cru": ["Bas de Vermarain à l'Est", "Derrière Chez Edouard", "Derrière la Tour", "Echaille", "En Créot", "En Montceau", "En Remilly", "En Vollon à l'Est", "En la Ranché", "Es Champs", "La Chatenière", "Le Bas de Gamay à l'Est", "Le Charmois", "Le Puits", "Les Castets", "Les Champlots", "Les Combes", "Les Combes au Sud", "Les Cortons", "Les Frionnes", "Les Murgers des Dents de Chien", "Les Perrières", "Les Travers de Marinot", "Marinot", "Pitangeret", "Sous Roche Dumay", "Sur Gamay", "Sur le Sentier du Clou", "Vignes Moingeon", "Village"]
            },
            "Santenay": {
                "Premier Cru": ["Beauregard", "Beaurepaire", "Clos Faubard", "Clos Rousseau", "Clos de Tavannes", "Clos des Mouches", "Grand Clos Rousseau", "La Comme", "La Maladière", "Les Gravières", "Les Gravières-Clos de Tavannes", "Passetemps"]
            },
            "Maranges": {
                "Premier Cru": ["Clos de la Boutière", "Clos de la Fussière", "La Fussière", "Le Clos des Loyères", "Le Clos des Rois", "Le Croix Moines", "Les Clos Roussots"]
            },
            "Rully": {
                "Premier Cru": ["Agneux", "Champs Cloux", "Chapitre", "Clos Saint-Jacques", "Clos du Chaigne", "Cloux", "Grésigny", "La Fosse", "La Pucelle", "Le Bressande", "Le Meix Cadot", "Le Meix Caillet", "Le Renarde", "Les Pierres", "Margotés", "Marissou", "Molesme", "Montpalais", "Pillot", "Préaux", "Rabourcé", "Raclout", "Vauvry"]
            },
            "Mercurey": {
                "Premier Cru": ["Clos Marcilly", "Clos Tonnerre", "Clos Voyens", "Clos de Paradis", "Clos des Barraults", "Clos des Montaigus", "Clos des Myglands", "Clos des grands Voyens", "Clos du Château de Montaigu", "Grand Clos Fortoul", "Griffères", "La Bondue", "La Cailloute", "La Chassière", "La Levrière", "La Mission", "Le Clos du Roy", "Le Clos l'Evêque", "Les Byots", "Les Champs Martin", "Les Combins", "Les Croichots", "Les Crêts", "Les Fourneaux", "Les Montaigus", "Les Naugues", "Les Puillets", "Les Ruelles", "Les Saumonts", "Les Vasées", "Les Velley", "Sazenay"]
            },
            "Givry": {
                "Premier Cru": ["A Vigne Rouge", "Cellier aux Moines", "Champ Nalot", "Clos Charlé", "Clos Jus", "Clos Marceaux", "Clos Marole", "Clos Salomon", "Clos de la Baraude", "Clos du Cras Long", "Clos du Vernoy", "Clos-Saint-Paul", "Clos-Saint-Pierre", "Crauzot (alt. Crausot)", "Crémillons", "En Choué", "En Veau", "La Brulee", "La Grande Berge", "La Matrosse", "La Petite Berge", "La Plante", "Le Champ Lalot", "Le Médenchot", "Le Paradis", "Le Petit Prétan", "Le Pied du Clou", "Le Vernoy", "Le Vigron", "Les Bois Chevaux", "Les Bois Gautiers", "Les Combes", "Les Galaffres", "Les Grandes Vignes", "Les Grands Prétans", "Petit Marole", "Pied de Chaume", "Servoisine"]
            },
            "Montagny": {
                "Premier Cru": ["Champ Toizeau", "Chazelle", "Cornevent", "Creux de Beaux Champs", "L'Epaule", "La Condemine le Vieux Château", "La Moullière", "Le Clos Chaudron", "Le Cloux", "Le Clouzot", "Le Grand Pièce", "Le Vieux Château", "Les Bassets", "Les Beaux Champs", "Les Bonneveaux", "Les Bordes", "Les Bouchots", "Les Burnins", "Les Chaniots", "Les Chaumelottes", "Les Combes", "Les Coudrettes", "Les Coères", "Les Craboulettes", "Les Garchères", "Les Gouresses", "Les Jardins", "Les Las", "Les Macles", "Les Maroques", "Les Paquiers", "Les Perrières", "Les Pidances", "Les Platières", "Les Resses", "Les Treuffères", "Les Vignes Derrière", "Les Vignes Longues", "Les Vignes des Prés", "Mont Laurent", "Montcuchot", "Montorge", "Saint-Ytages", "Sainte-Morille", "Sous les Feilles", "Vigne du Soleil", "Vignes Couland", "Vignes Saint-Pierre", "Vignes sur le Cloux"]
            },
            "Pouilly-Fuissé": {
                "Premier Cru": ["Au Vignerais", "Aux Bouthières", "Aux Chailloux", "Aux Quarts", "En France", "En Servy", "La Frérie", "La Maréchaude", "Le Clos", "Le Clos Reyssier", "Le Clos de Monsieur Noly", "Le Clos de Solutré", "Les Brulés", "Les Chevrières", "Les Crays", "Les Ménétrières", "Les Perrières", "Les Reisses", "Les Vignes Blanches", "Pouilly", "Sur la Roche", "Vers Cras"]
            },
            "Saint-Amour": {
                "Lieux-dits": ["Côte de Besset", "En Paradis", "La Folie", "Le Chatelet", "Le Clos de Guillons", "Le Clos de la Brosse", "Le Clos des Billards", "Le Clos du Chapître", "Le Mas des Tines", "Les Bonnets", "Les Champs Grillés", "Vers l’Eglise"]
            },
            "Juliénas": {
                "Lieux-dits": ["Beauvernay", "Bessay", "Bois de la Salle", "Cotoyon", "En Rizière", "La Bottière", "Les Capitans", "Les Fouillouses", "Les Mouilles", "Vayolette"]
            },
            "Chénas": {
                "Lieux-dits": ["Clos aux Blémonts", "Les Brureaux"]
            },
            "Moulin-à-Vent": {
                "Lieux-dits": ["Bois Combe", "Bois Maréchaux", "Bois Pondevaux", "Champ Poirier", "Champagne", "Champs de Cour", "Chassignol", "Deschanes", "En Brenay", "En Morier", "En Reclaine", "La Bruyère", "La Coudrière", "La Delatte", "La Dîme", "La Galletière", "La Grande Charrière", "La Pierre", "La Ranche", "La Roche", "La Rochelle", "La Teppe", "La Tour du Bief", "Le Bief", "Le Carquelin", "Le Fonds de Morier", "Le Mont", "Le Moulin à Vent", "Le Petit Morier", "Le Plantier de Fabre", "Le Venet", "Le Vieux Bourg", "Les Amandilliers", "Les Blancs", "Les Brasses", "Les Brussellion", "Les Bruyères des Thorins", "Les Burdelines", "Les Burdins", "Les Bûches", "Les Caves", "Les Combes", "Les Condemeines", "Les Deschamps", "Les Dégollets", "Les Ecorchés", "Les Fargets", "Les Fromentaux", "Les Garniers", "Les Gimarets", "Les Graiairiers", "Les Grenériers", "Les Grolliers", "Les Gros Vosges", "Les Guillattes", "Les Hantes", "Les Joies", "Les Maitairiers", "Les Michauds", "Les Michelons", "Les Millettes", "Les Moriers", "Les Moussières", "Les Petits Bois", "Les Philibons", "Les Pinchons", "Les Prés Ouverts", "Les Pérelles", "Les Rats", "Les Rouchaux (auds)", "Les Seignaux", "Les Seignes", "Les Thorins", "Les Vierres Manins", "Les Vérillats", "Maisons neuves", "Morperay", "Moulin Lure", "Petit Brenay", "Petites Caves", "Rochegrès", "Rochenoire", "Terre du Thé"]
            },
            "Fleurie": {
                "Lieux-dits": ["Champagne", "Grille-Midi", "La Chapelle de Bois", "La Joie du Palais", "La Madone", "La Roilette", "Le Bon Cru", "Les Côtes", "Les Garants", "Les Moriers", "Les Roches", "Montgenas", "Poncié"]
            },
            "Chiroubles": {
                "Lieux-dits": ["La Grosse Pierre", "Les Côtes"]
            },
            "Morgon": {
                "Lieux-dits": ["Corcelette", "Côte du Py", "Douby", "Grand Cras", "Les Charmes", "Les Micouds"]
            },
            "Régnié": {
                "Lieux-dits": ["Grange-Charton", "La Haute Plaigne"]
            },
            "Brouilly": {
                "Lieux-dits": ["Pisse-Vieille"]
            },
            "Côte de Brouilly": {
                "Lieux-dits": ["L’Ecluse", "L’Héronde"]
            }
        };
        
        const studyOrder = [
            { type: 'region', name: 'Chablis' },
            { type: 'village', name: 'Chablis' },
            { type: 'region', name: 'Côte de Nuits' },
            { type: 'village', name: 'Fixin' },
            { type: 'village', name: 'Gevrey-Chambertin' },
            { type: 'village', name: 'Morey-Saint-Denis' },
            { type: 'village', name: 'Chambolle-Musigny' },
            { type: 'village', name: 'Vougeot' },
            { type: 'village', name: 'Vosne-Romanée' },
            { type: 'village', name: 'Nuits-Saint-Georges' },
            { type: 'region', name: 'Côte de Beaune' },
            { type: 'village', name: 'Ladoix' },
            { type: 'village', name: 'Aloxe-Corton' },
            { type: 'village', name: 'Pernand-Vergelesses' },
            { type: 'village', name: 'Savigny-Lès-Beaune' },
            { type: 'village', name: 'Beaune' },
            { type: 'village', name: 'Pommard' },
            { type: 'village', name: 'Volnay' },
            { type: 'village', name: 'Monthélie' },
            { type: 'village', name: 'Auxey-Duresses' },
            { type: 'village', name: 'Meursault' },
            { type: 'village', name: 'Blagny' },
            { type: 'village', name: 'Puligny-Montrachet' },
            { type: 'village', name: 'Chassagne-Montrachet' },
            { type: 'village', name: 'Saint-Aubin' },
            { type: 'village', name: 'Santenay' },
            { type: 'village', name: 'Maranges' },
            { type: 'region', name: 'Côte Chalonnaise' },
            { type: 'village', name: 'Rully' },
            { type: 'village', name: 'Mercurey' },
            { type: 'village', name: 'Givry' },
            { type: 'village', name: 'Montagny' },
            { type: 'region', name: 'Mâconnais' },
            { type: 'village', name: 'Pouilly-Fuissé' },
            { type: 'region', name: 'Beaujolais' },
            { type: 'village', name: 'Saint-Amour' },
            { type: 'village', name: 'Juliénas' },
            { type: 'village', name: 'Chénas' },
            { type: 'village', name: 'Moulin-à-Vent' },
            { type: 'village', name: 'Fleurie' },
            { type: 'village', name: 'Chiroubles' },
            { type: 'village', name: 'Morgon' },
            { type: 'village', name: 'Régnié' },
            { type: 'village', name: 'Brouilly' },
            { type: 'village', name: 'Côte de Brouilly' },
        ];


        // DOM Elements
        const mainContent = document.getElementById('main-content');
        const welcomeModal = document.getElementById('welcome-modal');
        const modalOverlay = document.getElementById('modal-overlay');
        const startGameButton = document.getElementById('start-game-button');
        const studyModal = document.getElementById('study-modal');
        const studyModalOverlay = document.getElementById('study-modal-overlay');
        const studyButton = document.getElementById('study-button');
        const closeStudyButton = document.getElementById('close-study-button');
        const studyContent = document.getElementById('study-content');
        const feedbackModal = document.getElementById('feedback-modal');
        const feedbackModalOverlay = document.getElementById('feedback-modal-overlay');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');
        const continueButton = document.getElementById('continue-button');
        const gameArea = document.getElementById('game-area');
        const finalScoreArea = document.getElementById('final-score-area');
        const vineyardsEl = document.getElementById('vineyards');
        const optionsContainer = document.getElementById('options-container');
        const scoreEl = document.getElementById('score');
        const roundCounterEl = document.getElementById('round-counter');
        const finalScoreDisplay = document.getElementById('final-score-display');
        const finalPercentageDisplay = document.getElementById('final-percentage-display');
        const finalMessage = document.getElementById('final-message');
        const playAgainButton = document.getElementById('play-again-button');
        const footerInfo = document.getElementById('footer-info');
        const mainMenuButton = document.getElementById('main-menu-button');

        // Game State
        const totalRounds = 20;
        let correctVillage = '';
        let score = 0;
        let currentRound = 0;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function initializeGame() {
            score = 0;
            currentRound = 0;
            scoreEl.textContent = '0';
            
            gameArea.classList.remove('hidden');
            footerInfo.classList.remove('hidden');
            finalScoreArea.classList.add('hidden');
            
            generateQuestion();
        }

        function generateQuestion() {
            if (currentRound >= totalRounds) {
                endGame();
                return;
            }
            currentRound++;

            roundCounterEl.textContent = `${currentRound} / ${totalRounds}`;

            const villages = Object.keys(vineyardData);
            let potentialVillages = villages.filter(village => {
                const villageVineyards = vineyardData[village];
                const total = (villageVineyards["Grand Cru"]?.length || 0) + 
                              (villageVineyards["Premier Cru"]?.length || 0) + 
                              (villageVineyards["Lieux-dits"]?.length || 0);
                return total >= 3;
            });
            correctVillage = potentialVillages[Math.floor(Math.random() * potentialVillages.length)];
            
            const allVineyardsForVillage = [
                ...(vineyardData[correctVillage]["Grand Cru"] || []),
                ...(vineyardData[correctVillage]["Premier Cru"] || []),
                ...(vineyardData[correctVillage]["Lieux-dits"] || [])
            ];

            const selectedVineyards = shuffle(allVineyardsForVillage).slice(0, 3);

            vineyardsEl.innerHTML = '';
            selectedVineyards.forEach(vineyard => {
                const p = document.createElement('p');
                p.className = 'text-xl md:text-2xl font-semibold text-gray-800 tracking-wide leading-relaxed';
                p.textContent = vineyard;
                vineyardsEl.appendChild(p);
            });
            
            const options = [correctVillage];

            // Find a red herring village (one that contains at least one of the vineyards)
            const otherVillages = villages.filter(v => v !== correctVillage);
            let redHerring = null;
            const potentialRedHerrings = otherVillages.filter(village => {
                const allVineyardsInVillage = [
                    ...(vineyardData[village]["Grand Cru"] || []),
                    ...(vineyardData[village]["Premier Cru"] || []),
                    ...(vineyardData[village]["Lieux-dits"] || [])
                ];
                return selectedVineyards.some(v => allVineyardsInVillage.includes(v));
            });

            if (potentialRedHerrings.length > 0) {
                redHerring = potentialRedHerrings[Math.floor(Math.random() * potentialRedHerrings.length)];
                options.push(redHerring);
            }

            // Fill remaining options with random distractors
            let distractorPool = villages.filter(v => !options.includes(v));
            distractorPool = shuffle(distractorPool);
            
            while(options.length < 4) {
                options.push(distractorPool.pop());
            }

            const finalOptions = shuffle(options);
            optionsContainer.innerHTML = '';
            finalOptions.forEach(option => {
                const button = document.createElement('button');
                button.className = 'btn-option w-full bg-white border border-gray-300 text-gray-700 font-semibold p-4 rounded-lg shadow-sm hover:bg-gray-50 cursor-pointer';
                button.textContent = option.replace(/ AOP$/, "");
                button.dataset.optionValue = option;
                optionsContainer.appendChild(button);
            });
        }

        function handleOptionClick(event) {
            const button = event.target.closest('button.btn-option');
            if (!button || button.disabled) return;
            
            const selectedOption = button.dataset.optionValue;
            checkAnswer(selectedOption, button);
        }

        function checkAnswer(selectedOption, button) {
            const allButtons = optionsContainer.querySelectorAll('button');
            allButtons.forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.optionValue === correctVillage) {
                    btn.classList.add('correct');
                }
            });

            if (selectedOption === correctVillage) {
                score++;
                showFeedbackModal(true);
            } else {
                button.classList.add('incorrect');
                showFeedbackModal(false);
            }
            
            scoreEl.textContent = score;
        }
        
        function showFeedbackModal(isCorrect) {
            if (isCorrect) {
                feedbackTitle.textContent = "Correct!";
                feedbackTitle.className = "text-4xl font-bold title-font mb-4 text-green-600";
                feedbackText.textContent = "Excellent! You've nailed it.";
            } else {
                feedbackTitle.textContent = "Incorrect";
                feedbackTitle.className = "text-4xl font-bold title-font mb-4 text-red-600";
                feedbackText.innerHTML = `The correct village is <strong class="underline">${correctVillage.replace(/ AOP$/, "")}</strong>.`;
            }
            
            if (currentRound >= totalRounds) {
                continueButton.textContent = "See Results";
            } else {
                continueButton.textContent = "Next Round";
            }

            feedbackModal.classList.add('active');
            feedbackModalOverlay.classList.add('active');
        }

        function hideFeedbackModal() {
            feedbackModal.classList.remove('active');
            feedbackModalOverlay.classList.remove('active');
        }

        function advanceGame() {
            hideFeedbackModal();
            generateQuestion();
        }

        function endGame() {
            gameArea.classList.add('hidden');
            footerInfo.classList.add('hidden');
            finalScoreArea.classList.remove('hidden');
            
            const percentage = Math.round((score / totalRounds) * 100);
            finalScoreDisplay.textContent = `${score} / ${totalRounds}`;
            finalPercentageDisplay.textContent = `(${percentage}%)`;
            
            let message = '';
            if (percentage === 100) {
                message = "You are a true Burgundy Legend! Your knowledge is unparalleled. Keep playing to defend your title!";
            } else if (percentage >= 80) {
                message = "Excellent work! You have a deep understanding of Burgundy's vineyards. A true connoisseur!";
            } else if (percentage >= 60) {
                message = "Great job! You're well on your way to mastering the Côte d'Or. Keep practicing!";
            } else if (percentage >= 40) {
                message = "Solid effort! You've got a good foundation. A few more rounds and you'll be a pro.";
            } else {
                message = "A noble start! Burgundy is complex, but every expert starts somewhere. Keep exploring!";
            }
            finalMessage.textContent = message;
        }
        
        function populateStudyGuide() {
            studyContent.innerHTML = '';
            
            studyOrder.forEach(item => {
                if (item.type === 'region') {
                    const regionTitle = document.createElement('h2');
                    regionTitle.className = 'text-3xl font-bold text-black title-font mt-8 mb-4 border-b-2 border-gray-300 pb-2';
                    regionTitle.textContent = item.name;
                    studyContent.appendChild(regionTitle);
                } else if (item.type === 'village') {
                    const villageData = vineyardData[item.name];
                    const villageDiv = document.createElement('div');
                    villageDiv.className = 'mb-6';
                    
                    const villageTitle = document.createElement('h3');
                    villageTitle.className = 'text-2xl font-bold text-red-800 title-font mb-3';
                    villageTitle.textContent = item.name.replace(/ AOP$/, "");
                    villageDiv.appendChild(villageTitle);

                    const classifications = ["Grand Cru", "Premier Cru", "Lieux-dits"];
                    classifications.forEach(classification => {
                        if (villageData[classification] && villageData[classification].length > 0) {
                            const classificationTitle = document.createElement('h4');
                            classificationTitle.className = 'text-lg font-semibold text-gray-700 mt-2 mb-1';
                            classificationTitle.textContent = classification === 'Lieux-dits' ? 'Lieux-dits' : classification + 's';
                            villageDiv.appendChild(classificationTitle);

                            const vineyardList = document.createElement('p');
                            vineyardList.className = 'text-gray-600 leading-relaxed';
                            vineyardList.textContent = villageData[classification].sort().join(', ');
                            villageDiv.appendChild(vineyardList);
                        }
                    });
                    
                    studyContent.appendChild(villageDiv);
                }
            });
        }

        // --- Event Listeners ---
        window.onload = () => {
            welcomeModal.classList.add('active');
            modalOverlay.classList.add('active');
        };

        startGameButton.addEventListener('click', () => {
            welcomeModal.classList.remove('active');
            modalOverlay.classList.remove('active');
            mainContent.classList.remove('hidden');
            initializeGame();
        });
        
        studyButton.addEventListener('click', () => {
            populateStudyGuide();
            studyModal.classList.add('active');
            studyModalOverlay.classList.add('active');
        });
        
        closeStudyButton.addEventListener('click', () => {
            studyModal.classList.remove('active');
            studyModalOverlay.classList.remove('active');
        });

        continueButton.addEventListener('click', advanceGame);
        playAgainButton.addEventListener('click', initializeGame);
        optionsContainer.addEventListener('click', handleOptionClick);
        
        mainMenuButton.addEventListener('click', () => {
            mainContent.classList.add('hidden');
            welcomeModal.classList.add('active');
            modalOverlay.classList.add('active');
        });
    </script>

</body>
</html>
