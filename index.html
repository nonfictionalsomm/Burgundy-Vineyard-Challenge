<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Burgundy Gambit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f3ef; /* A warm, paper-like background */
        }
        .title-font {
            font-family: 'Lora', serif;
        }
        .btn-option {
            transition: all 0.2s ease-in-out;
        }
        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .correct {
            background-color: #22c55e !important; /* green-500 */
            color: white;
            border-color: #16a34a;
        }
        .incorrect {
            background-color: #ef4444 !important; /* red-500 */
            color: white;
            border-color: #dc2626;
        }
        .hidden {
            display: none;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 40;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            z-index: 50;
            opacity: 0;
            transition: all 0.3s ease-in-out;
            pointer-events: none;
        }
        .modal-container.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Welcome Modal -->
    <div id="modal-overlay" class="modal-overlay"></div>
    <div id="welcome-modal" class="modal-container w-full max-w-lg">
        <div class="bg-white rounded-2xl shadow-xl p-8 text-center">
            <h2 class="text-4xl font-bold text-gray-800 title-font mb-4">The Burgundy Gambit</h2>
            <p class="text-gray-600 mb-2">Welcome, wine adventurer!</p>
            <p class="text-gray-600 mb-4">We'll show you three famous Burgundian vineyards (*climats*). Your task is to identify the correct village appellation where they are located. The challenge covers vineyards from Chablis to Beaujolais.</p>
            <p class="text-gray-600 mb-6">The path to mastery is paved with practice. Play again and again to sharpen your knowledge and become a true Burgundy legend!</p>
            <div class="flex flex-col sm:flex-row gap-4">
                 <button id="study-button" class="w-full bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors duration-200">
                    Study First?
                </button>
                <button id="start-game-button" class="w-full bg-red-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-900 transition-colors duration-200 shadow-md">
                    Begin the Challenge
                </button>
            </div>
        </div>
    </div>
    
    <!-- Study Modal -->
    <div id="study-modal-overlay" class="modal-overlay"></div>
    <div id="study-modal" class="modal-container w-full max-w-3xl">
        <div class="bg-white rounded-2xl shadow-xl p-8 flex flex-col" style="max-height: 80vh;">
            <div class="flex-shrink-0 text-center mb-4">
                <h2 class="text-3xl font-bold text-gray-800 title-font">Vineyard Database</h2>
            </div>
            <div id="study-content" class="flex-grow overflow-y-auto pr-4">
                <!-- Data will be injected here -->
            </div>
            <div class="flex-shrink-0 mt-6 text-center">
                <button id="close-study-button" class="bg-red-800 text-white font-bold py-2 px-8 rounded-lg hover:bg-red-900 transition-colors duration-200 shadow-md">
                    Close
                </button>
            </div>
        </div>
    </div>


    <!-- Answer Feedback Modal -->
    <div id="feedback-modal-overlay" class="modal-overlay"></div>
    <div id="feedback-modal" class="modal-container w-full max-w-sm">
        <div id="feedback-modal-content" class="bg-white rounded-2xl shadow-xl p-8 text-center">
            <h2 id="feedback-title" class="text-4xl font-bold title-font mb-4"></h2>
            <p id="feedback-text" class="text-gray-600 mb-6"></p>
            <button id="continue-button" class="w-full bg-red-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-900 transition-colors duration-200 shadow-md">
                Continue
            </button>
        </div>
    </div>

    <!-- Main Game Content -->
    <div id="main-content" class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-10 hidden">
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 title-font">The Burgundy Gambit</h1>
            <p id="subtitle" class="text-gray-600 mt-2">Which village are these vineyards located in?</p>
        </div>

        <!-- Game Area -->
        <div id="game-area">
            <div id="question-container" class="bg-red-900/5 border border-red-900/10 rounded-lg p-6 mb-8 text-center min-h-[10rem] flex items-center justify-center">
                <div id="vineyards" class="text-center"></div>
            </div>
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"></div>
        </div>
        
        <!-- Final Score Area -->
        <div id="final-score-area" class="hidden text-center py-8">
            <h2 class="text-3xl font-bold text-gray-800 title-font mb-2">Challenge Complete!</h2>
            <p class="text-5xl font-bold text-red-800 mb-4" id="final-score-display"></p>
            <p class="text-xl text-gray-700 font-semibold mb-4" id="final-percentage-display"></p>
            <p class="text-lg text-gray-600" id="final-message"></p>
            <button id="play-again-button" class="mt-6 bg-red-800 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-900 transition-colors duration-200 shadow-md">
                Play Again?
            </button>
        </div>

        <!-- Footer Info -->
        <div id="footer-info" class="flex items-center justify-between text-center mt-8">
            <div class="text-left">
                <span class="text-gray-500">Score</span>
                <p id="score" class="text-2xl font-bold text-gray-800">0</p>
            </div>
            <div>
                 <span class="text-gray-500">Round</span>
                <p id="round-counter" class="text-2xl font-bold text-gray-800">0 / 20</p>
            </div>
        </div>
    </div>

    <script>
        const vineyardData = {
            "Chablis": {
                "Grand Cru": ["Blanchot", "Bougros", "Grenouilles", "Les Clos", "Preuses", "Valmur", "Vaudésir"],
                "Premier Cru": ["Berdiot", "Chapelot", "Côte de Bréchain", "Côte de Fontenay", "Côte des Prés Girots", "Côte de Vaubarousse", "Fourchaume", "L'Homme Mort", "Les Fourneaux", "Mont de Milieu", "Montée de Tonnerre", "Morein", "Pied d'Aloup", "Vaucoupin", "Vaulorent", "Vaupulent", "Beauroy", "Beugnons", "Butteaux", "Chatains", "Chaume de Talvat", "Côte de Léchet", "Côte de Cuisy", "Côte de Jouan", "Côte de Savant", "Forêts", "Les Beauregards", "Les Épinottes", "Les Lys", "Mélinots", "Montmains", "Roncières", "Sécher", "Troesmes", "Vau de Vey", "Vaillons", "Vaugiraut", "Vosgros", "Vau Ligneau", "Vaux Ragons"]
            },
            "Fixin": {
                "Premier Cru": ["Arvelets", "Clos de la Perrière", "Clos Napoléon", "Hervelets", "Le Clos du Chapitre", "Les Meix Bas"]
            },
            "Gevrey-Chambertin": {
                "Grand Cru": ["Chambertin", "Chambertin Clos de Bèze", "Chapelle-Chambertin", "Charmes-Chambertin", "Griotte-Chambertin", "Latricières-Chambertin", "Mazis-Chambertin", "Mazoyères-Chambertin", "Ruchottes-Chambertin"],
                "Premier Cru": ["Au-Closeau", "Aux Combottes", "Bel Air", "Champonnet", "Cherbaudes", "Clos des Varoilles", "Clos du Chapitre", "Clos Prieur", "Clos Saint-Jacques", "Craipillot", "En Ergot", "Estournelles-Saint-Jacques", "Fonteny", "Issarts", "La Boissière", "La Combe-au-Moine", "La Perrière", "La Romanée", "Lavaux-Saint-Jacques", "Les Cazetiers", "Les Champeaux", "Les Corbeaux", "Les Goulots", "Les Petits-Cazetiers", "Petite-Chapelle", "Poissenot"]
            },
            "Morey-Saint-Denis": {
                "Grand Cru": ["Bonnes Mares", "Clos de La Roche", "Clos de Tart", "Clos des Lambrays", "Clos Saint-Denis"],
                "Premier Cru": ["Aux Charmes", "Aux Cheseaux", "Clos Baulet", "Clos des Ormes", "Clos Sorbè", "Côte Rotie", "La Bussière", "La Riotte", "Le Village", "Les Blanchards", "Les Chaffots", "Les Charrières", "Les Chenevery", "Les Faconnières", "Les Genavrières", "Les Gruenchers", "Les Millandes", "Les Ruchots", "Les Sorbès", "Monts Luisants"]
            },
            "Chambolle-Musigny": {
                "Grand Cru": ["Bonnes Mares", "Musigny"],
                "Premier Cru": ["Aux Beaux Bruns", "Aux Combottes", "Aux Échanges", "Derrière la Grange", "La Combe d'Orveau", "Les Amoureuses", "Les Baudes", "Les Borniques", "Les Carrières", "Les Chabiots", "Les Charmes", "Les Chatelots", "Les Cras", "Les Feusselottes/Les Feusselotes", "Les Fuées", "Les Grand Murs", "Les Groseilles", "Les Gruenchers", "Les Hauts-Doix", "Les Lavrottes", "Les Noirots", "Les Plantes", "Les Sentiers", "Les Véroilles"]
            },
            "Vougeot": {
                "Grand Cru": ["Clos de Vougeot"],
                "Premier Cru": ["Clos de la Perrière", "Le Clos Blanc", "Les Crâs", "Le Petits Vougeots"]
            },
            "Vosne-Romanée": {
                "Grand Cru": ["Echézeaux", "Grands-Echézeaux", "La Grande Rue", "Richebourg", "La Romanée", "Romanée-Conti", "Romanée-Saint-Vivant", "La Tâche"],
                "Premier Cru": ["Aux Brûlées", "Au-dessus des Malconsorts", "Aux Malconsorts", "Aux Raignots", "Clos des Réas", "Cros Parantoux", "En Orveaux", "Les Beaux Monts", "Les Chaumes", "La Croix Rameau", "Les Gaudichots", "Les Petits Monts", "Les Rouges", "Les Suchots"]
            },
            "Nuits-Saint-Georges": {
                "Premier Cru": ["Aux Argillas", "Aux Boudots", "Aux Bousselots", "Aux Chaignots", "Aux Champs Perdrix", "Aux Cras", "Aux Murgers", "Aux Perdrix", "Aux Thorey", "Aux Vignerondes", "Chaines Carteaux", "Château Gris", "Clos Arlot", "Clos des Argillières", "Clos des Corvées", "Clos des Corvées Pagets", "Clos des Forêts Saint-Georges", "Clos des Grandes Vignes", "Clos de la Maréchale", "Clos des Porrets-Saint-Georges", "Clos Saint-Marc", "En la Perrière Noblot", "Les Argillières", "Les Cailles", "Les Chabœufs", "Les Crots", "Les Damodes", "Les Didiers", "Les Hauts Pruliers", "Les Perrières", "Les Porrets-Saint-Georges", "Les Poulettes", "Les Procès", "Les Pruliers", "La Richemone", "Les Saints-Georges", "Les Terres Blanches", "Les Vallerots", "Les Vaucrains", "Roncière", "Rue de Chaux"]
            },
            "Ladoix": {
                "Grand Cru": ["Corton", "Corton-Charlemagne"],
                "Premier Cru": ["Basses Mourottes", "Bois Roussot", "En Naget", "Hautes Mourottes", "La Corvée", "La Micaude", "Le Clou d'Orge", "Le Rognet et Corton", "Les Buis", "Les Grêchons et Foutrières", "Les Joyeuses"]
            },
            "Aloxe-Corton": {
                "Grand Cru": ["Corton", "Corton-Charlemagne", "Charlemagne"],
                "Premier Cru": ["Clos des Maréchaudes", "Clos du Chapitre", "La Coutière", "La Maréchaude", "La Toppe au Vert", "Les Chaillots", "Les Fournières", "Les Guérets", "Les Maréchaudes", "Les Moutottes", "Les Paulands", "Les Petites Lolières", "Les Valozières", "Les Vercots"]
            },
            "Pernand-Vergelesses": {
                "Grand Cru": ["Corton", "Corton-Charlemagne", "Charlemagne"],
                "Premier Cru": ["Clos Berthet", "Creux de la Net", "En Caradeux", "Ile des Vergelesses", "Les Fichots", "Sous Frétille", "Vergelesses", "Village de Pernand"]
            },
            "Savigny-Lès-Beaune": {
                "Premier Cru": ["Aux Clous", "Aux Fourneaux", "Aux Gravains", "Aux Guettes", "Aux Serpentières", "Basses Vergelesses", "Bataillière", "Champ Chevrey", "Les Charnières", "La Dominode", "Les Hauts Jarrons", "Les Hauts Marconnets", "Les Jarrons", "Les Lavières", "Les Marconnets", "Les Narbantons", "Les Peuillets", "Les Rouvrettes", "Les Talmettes", "Les Vergelesses", "Petits Godeaux", "Redrescul"]
            },
            "Beaune": {
                "Premier Cru": ["A l'Ecu", "Aux Coucherias", "Aux Cras", "Belissand", "Blanches Fleurs", "Champs Pimont", "Clos de l'Ecu", "Clos de la Feguine", "Clos de la Mousse", "Clos des Avaux", "Clos des Ursules", "Clos du Roi", "Clos Saint-Landry", "En Genêt", "En l'Orme", "La Mignotte", "Le Bas des Teurons", "Le Clos des Mouches", "Les Aigrots", "Les Avaux", "Les Boucherottes", "Les Bressandes", "Les Cents Vignes", "Les Chouacheux", "Les Epenotes", "Les Fèves", "Les Grèves", "Les Marconnets", "Les Montrevenots", "Les Perrières", "Les Reversés", "Les Sceaux", "Les Seurey", "Les Sizies", "Les Teurons", "Les Toussaints", "Les Tuvilains", "Les Vignes Franches", "Montée Rouge", "Pertuisots", "Sur les Grèves", "Sur les Grèves-Clos Sainte-Anne"]
            },
            "Pommard": {
                "Premier Cru": ["Clos Blanc", "Clos de la Commaraine", "Clos des Epeneaux", "Clos de Verger", "Derrière Saint-Jean", "En Largillière", "Les Arvelets", "Les Bertins", "Les Boucherottes", "La Chanière", "Les Chanlins-Bas", "Les Chaponnières", "Les Charmots", "Le Clos Micot", "Les Combes Dessus", "Les Croix Noires", "Les Fremiers", "Les Grands Epenots", "Les Jarolières", "Les Petits Epenots", "Les Pézerolles", "La Platière", "Les Poutures", "La Refène", "Les Rugiens Bas", "Les Rugiens Hauts", "Les Saussilles", "Le Village"]
            },
            "Volnay": {
                "Premier Cru": ["Carelle sous la Chapelle", "Champans", "Clos des 60 Ouvrées", "Clos de l'Audignac", "Clos du Château des Ducs", "Clos des Chênes", "Clos des Ducs", "Clos de la Barre", "Clos de la Bousse d'Or", "Clos de la Cave des Ducs", "Clos de la Chapelle", "Clos de la Rougeotte", "Clos du Verseuil", "En Chevret", "Frémiets", "Frémiets ― Clos de la Rougeotte", "Lassolle", "Les Angles", "Les Brouillards", "Les Caillerets", "La Gigotte", "Les Lurets", "Les Mitans", "Le Ronceret", "Le Village", "Pitures Dessus", "Robardelle", "Santenots", "Taille Pieds"]
            },
            "Monthélie": {
                "Premier Cru": ["Clos des Toisières", "La Taupine", "Le Cas Rougeot", "Le Château Gaillard", "Le Clos Gauthey", "Le Clou des Chênes", "Le Meix Bataille", "Le Village", "Les Barbières", "Les Champs Fulliots", "Les Clous", "Les Duresses", "Les Riottes", "Les Vignes Rondes", "Sur la Velle"]
            },
            "Auxey-Duresses": {
                "Premier Cru": ["Bas des Duresses", "Climat du Val", "Clos du Val", "Les Bréterins", "La Chapelle", "Les Duresses", "Les Ecussaux", "Les Grands Champs", "Reugne"]
            },
            "Meursault": {
                "Premier Cru": ["Blagny", "Charmes", "Clos des Perrières", "Genevrières", "Les Bouchères", "Les Caillerets", "Les Cras", "Les Gouttes d'Or", "La Jeunellotte/Genelotte", "La Pièce sous le Bois", "Les Plures", "Le Porusot", "Les Ravelles", "Les Santenots Blancs", "Les Santenots du Milieu", "Perrières", "Porusot", "Sous Blagny", "Sous le Dos d'Ane"]
            },
            "Blagny": {
                "Premier Cru": ["Hameau de Blagny", "La Garenne", "La Jeunellotte", "La Pièce sous le Bois", "Sous le Dos d'Ane", "Sous Blagny", "Sous le Puits"]
            },
            "Puligny-Montrachet": {
                "Grand Cru": ["Bâtard-Montrachet", "Bienvenues-Bâtard-Montrachet", "Chevalier-Montrachet", "Montrachet"],
                "Premier Cru": ["Champ Canet", "Champ Gain", "Clavaillon", "Clos de la Garenne", "Clos de la Mouchère", "Hameau de Blagny", "Le Cailleret", "Les Chalumaux", "Les Combettes", "Les Demoiselles", "Les Folatières", "La Garenne", "Les Perrières", "Les Pucelles", "Les Referts", "La Truffière", "Sous le Puits"]
            },
            "Saint-Aubin": {
                "Premier Cru": ["Bas de Vermarain à l'Est", "Derrière Chez Edouard", "Derrière la Tour", "Echaille", "En Créot", "En la Ranché", "En Montceau", "En Remilly", "En Vollon à l'Est", "Es Champs", "La Chatenière", "Le Bas de Gamay à l'Est", "Le Charmois", "Le Puits", "Les Castets", "Les Champlots", "Les Combes", "Les Combes au Sud", "Les Cortons", "Les Frionnes", "Les Murgers des Dents de Chien", "Les Perrières", "Les Travers de Marinot", "Marinot", "Pitangeret", "Sous Roche Dumay", "Sur Gamay", "Sur le Sentier du Clou", "Vignes Moingeon", "Village"]
            },
            "Chassagne-Montrachet": {
                "Grand Cru": ["Bâtard-Montrachet", "Criots-Bâtard-Montrachet", "(le) Montrachet"],
                "Premier Cru": ["Abbaye de Morgeot", "Blanchot Dessus", "Bois de Chassagne", "Cailleret", "Champs Jendreau", "Chassagne", "Chassagne du Clos Saint-Jean", "Clos Chareau", "Clos Pitois", "Clos Saint-Jean", "Dent de Chien", "En Cailleret", "En Remilly", "En Virondot", "Ez Crets", "Ez Crottes", "Francemont", "Guerchère", "La Boudriotte", "La Cardeuse", "La Chapelle", "La Grande Borne", "La Grande Montagne", "La Maltroie", "La Romanée", "La Roquemaure", "Les Baudines", "Les Bondues", "Les Boirettes", "Les Brussonnes", "Les Champs Gain", "Les Chaumées", "Les Chaumes", "Les Chenevottes", "Les Combards", "Les Commes", "Les Embazées", "Les Fairendes", "Les Grands Clos", "Les Grandes Ruchottes", "Les Macherelles", "Les Murées", "Les Pasquelles", "Les Petits Clos", "Les Petites Fairendes", "Les Places", "Les Rebichets", "Les Vergers", "Morgeot", "Petingeret", "Tête du Clos", "Tonton Marcel", "Vide Bourse", "Vigne Blanche", "Vigne Derrière"]
            },
            "Santenay": {
                "Premier Cru": ["Beauregard", "Beaurepaire", "Clos des Mouches", "Clos de Tavannes", "Clos Faubard", "Clos Rousseau", "Grand Clos Rousseau", "La Comme", "Les Gravières", "Les Gravières-Clos de Tavannes", "La Maladière", "Passetemps"]
            },
            "Maranges": {
                "Premier Cru": ["Clos de la Boutière", "Clos de la Fussière", "La Fussière", "Le Clos des Loyères", "Le Clos des Rois", "Le Croix Moines", "Les Clos Roussots"]
            },
            "Rully": {
                "Premier Cru": ["Clos Saint-Jacques", "Clos du Chaigne", "Le Meix Caillet", "Marissou", "La Fosse", "Agneux", "Les Pierres", "Pillot", "Raclout", "Cloux", "Rabourcé", "Chapitre", "Préaux", "Le Meix Cadot", "Molesme", "Le Bressande", "Champs Cloux", "Le Renarde", "Montpalais", "Grésigny", "Margotés", "Vauvry", "La Pucelle"]
            },
            "Mercurey": {
                "Premier Cru": ["Clos des Barraults", "Clos des grands Voyens", "Clos des Myglands", "Clos du Château de Montaigu", "Clos Marcilly", "Clos Tonnerre", "Clos Voyens", "Grand Clos Fortoul", "Griffères", "La Bondue", "La Cailloute", "La Levrière", "La Mission", "Le Clos du Roy", "Le Clos l'Evêque", "Les Byots", "Les Champs Martin", "Les Combins", "Les Crêts", "Les Croichots", "Les Naugues", "Les Puillets", "Les Saumonts", "Les Vasées", "Les Velley", "Sazenay", "Clos de Paradis", "Clos des Montaigus", "La Chassière", "Les Fourneaux", "Les Montaigus", "Les Ruelles"]
            },
            "Givry": {
                "Premier Cru": ["Clos Jus", "Le Champ Lalot", "Champ Nalot", "Crémillons", "Clos du Cras Long", "La Grande Berge", "En Choué", "Clos Marole", "Petit Marole", "Cellier aux Moines", "Servoisine", "Les Bois Chevaux", "Clos-Saint-Pierre", "Clos-Saint-Paul", "Clos Charlé", "Le Petit Prétan", "Les Grands Prétans", "Clos Salomon", "Clos du Vernoy", "Le Paradis", "Les Grandes Vignes", "Clos Marceaux", "Le Vigron", "Les Bois Gautiers", "Clos de la Baraude", "A Vigne Rouge", "En Veau", "La Brulee", "La Petite Berge", "Le Vernoy", "Les Combes", "Les Galaffres", "Le Pied du Clou", "Pied de Chaume", "La Plante", "La Matrosse", "Le Médenchot", "Crauzot (alt. Crausot)"]
            },
            "Montagny": {
                "Premier Cru": ["Le Clouzot", "Les Pidances", "Les Coudrettes", "Les Vignes Longues", "Cornevent", "Mont Laurent", "Les Bonneveaux", "Les Bassets", "Les Coères", "Les Chaniots", "Chazelle", "Vignes Saint-Pierre", "Les Combes", "Saint-Ytages", "Les Chaumelottes", "Champ Toizeau", "Vignes sur le Cloux", "Les Garchères", "Vignes Couland", "Les Bouchots", "Les Burnins", "Les Perrières", "Les Treuffères", "Montcuchot", "Vigne du Soleil", "Les Maroques", "Les Beaux Champs", "Les Macles", "Creux de Beaux Champs", "L'Epaule", "Les Platières", "Les Jardins", "Sainte-Morille", "Les Vignes Derrière", "Les Bordes", "Les Las", "Les Gouresses", "Les Paquiers", "Montorge", "Les Resses", "Le Cloux", "Sous les Feilles", "La Moullière", "Les Craboulettes", "Le Clos Chaudron", "Le Grand Pièce", "Les Vignes des Prés", "Le Vieux Château", "La Condemine le Vieux Château"]
            },
            "Pouilly-Fuissé": {
                "Premier Cru": ["Le Clos de Monsieur Noly", "Les Chevrières", "Aux Quarts", "Le Clos Reyssier", "Le Clos", "Les Brulés", "Les Ménétrières", "Les Reisses", "Les Vignes Blanches", "Les Perrières", "Vers Cras", "La Frérie", "Le Clos de Solutré", "Au Vignerais", "En Servy", "Aux Bouthières", "Aux Chailloux", "Pouilly", "Les Crays", "La Maréchaude", "Sur la Roche", "En France"]
            },
            "Brouilly": {
                "Lieux-dits": ["Pisse-Vieille"]
            },
            "Chiroubles": {
                "Lieux-dits": ["La Grosse Pierre", "Les Côtes"]
            },
            "Chénas": {
                "Lieux-dits": ["Les Brureaux", "Clos aux Blémonts"]
            },
            "Côte de Brouilly": {
                "Lieux-dits": ["L’Héronde", "L’Ecluse"]
            },
            "Fleurie": {
                "Lieux-dits": ["Les Côtes", "Le Bon Cru", "La Roilette", "Les Moriers", "Les Roches", "Les Garants", "Poncié", "Montgenas", "La Chapelle de Bois", "La Madone", "Grille-Midi", "Champagne", "La Joie du Palais"]
            },
            "Juliénas": {
                "Lieux-dits": ["Les Capitans", "Les Fouillouses", "Les Mouilles", "La Bottière", "Vayolette", "Bessay", "En Rizière", "Beauvernay", "Bois de la Salle", "Cotoyon"]
            },
            "Morgon": {
                "Lieux-dits": ["Douby", "Les Charmes", "Côte du Py", "Grand Cras", "Corcelette", "Les Micouds"]
            },
            "Moulin-à-Vent": {
                "Lieux-dits": ["La Bruyère", "Les Gros Vosges", "Maisons neuves", "La Grande Charrière", "Les Michelons", "Le Moulin à Vent", "Champagne", "Champs de Cour", "Les Deschamps", "Le Carquelin", "Le Mont", "Le Plantier de Fabre", "Les Pinchons", "Les Bruyères des Thorins", "Les Seignaux", "Les Dégollets", "Les Thorins", "Morperay", "La Tour du Bief", "La Galletière", "Les Vérillats", "Les Fromentaux", "Le Vieux Bourg", "La Teppe", "Les Vierres Manins", "Petit Brenay", "Les Prés Ouverts", "En Brenay", "Les Pérelles", "La Pierre", "Les Moriers", "Moulin Lure", "Les Philibons", "En Reclaine", "La Delatte", "Bois Pondevaux", "La Roche", "Les Bûches", "Le Petit Morier", "Les Brussellion", "Bois Maréchaux", "Les Fargets", "Les Rouchaux (auds)", "Les Gimarets", "Les Combes", "Les Seignes", "Bois Combe", "Les Moussières", "Les Petits Bois", "Les Millettes", "Les Grenériers", "Les Burdelines", "Les Guillattes", "Les Graiairiers", "Les Amandilliers", "Le Fonds de Morier", "Le Bief", "En Morier", "Les Blancs", "Champ Poirier", "Les Caves", "Les Maitairiers", "Chassignol", "Les Michauds", "La Coudrière", "Les Ecorchés", "Deschanes", "La Ranche", "Les Joies", "Les Garniers", "La Dîme", "Les Condemeines", "Rochegrès", "Le Venet", "La Rochelle", "Les Burdins", "Rochenoire", "Petites Caves", "Terre du Thé", "Les Rats", "Les Brasses", "Les Hantes", "Les Grolliers"]
            },
            "Régnié": {
                "Lieux-dits": ["Grange-Charton", "La Haute Plaigne"]
            },
            "Saint-Amour": {
                "Lieux-dits": ["Côte de Besset", "Les Champs Grillés", "Le Clos de la Brosse", "Le Clos de Guillons", "Le Chatelet", "Le Clos des Billards", "Les Bonnets", "Le Mas des Tines", "Vers l’Eglise", "En Paradis", "La Folie", "Le Clos du Chapître"]
            }
        };

        // DOM Elements
        const mainContent = document.getElementById('main-content');
        const welcomeModal = document.getElementById('welcome-modal');
        const modalOverlay = document.getElementById('modal-overlay');
        const startGameButton = document.getElementById('start-game-button');
        const studyModal = document.getElementById('study-modal');
        const studyModalOverlay = document.getElementById('study-modal-overlay');
        const studyButton = document.getElementById('study-button');
        const closeStudyButton = document.getElementById('close-study-button');
        const studyContent = document.getElementById('study-content');
        const feedbackModal = document.getElementById('feedback-modal');
        const feedbackModalOverlay = document.getElementById('feedback-modal-overlay');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');
        const continueButton = document.getElementById('continue-button');
        const gameArea = document.getElementById('game-area');
        const finalScoreArea = document.getElementById('final-score-area');
        const vineyardsEl = document.getElementById('vineyards');
        const optionsContainer = document.getElementById('options-container');
        const scoreEl = document.getElementById('score');
        const roundCounterEl = document.getElementById('round-counter');
        const finalScoreDisplay = document.getElementById('final-score-display');
        const finalPercentageDisplay = document.getElementById('final-percentage-display');
        const finalMessage = document.getElementById('final-message');
        const playAgainButton = document.getElementById('play-again-button');
        const footerInfo = document.getElementById('footer-info');

        // Game State
        const totalRounds = 20;
        let correctVillage = '';
        let score = 0;
        let currentRound = 0;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function initializeGame() {
            score = 0;
            currentRound = 0;
            scoreEl.textContent = '0';
            
            gameArea.classList.remove('hidden');
            footerInfo.classList.remove('hidden');
            finalScoreArea.classList.add('hidden');
            
            generateQuestion();
        }

        function generateQuestion() {
            if (currentRound >= totalRounds) {
                endGame();
                return;
            }
            currentRound++;

            roundCounterEl.textContent = `${currentRound} / ${totalRounds}`;

            const villages = Object.keys(vineyardData);
            let potentialVillages = villages.filter(village => {
                const villageVineyards = vineyardData[village];
                const total = (villageVineyards["Grand Cru"]?.length || 0) + 
                              (villageVineyards["Premier Cru"]?.length || 0) + 
                              (villageVineyards["Lieux-dits"]?.length || 0);
                return total >= 3;
            });
            correctVillage = potentialVillages[Math.floor(Math.random() * potentialVillages.length)];
            
            const allVineyardsForVillage = [
                ...(vineyardData[correctVillage]["Grand Cru"] || []),
                ...(vineyardData[correctVillage]["Premier Cru"] || []),
                ...(vineyardData[correctVillage]["Lieux-dits"] || [])
            ];

            const selectedVineyards = shuffle(allVineyardsForVillage).slice(0, 3);

            vineyardsEl.innerHTML = '';
            selectedVineyards.forEach(vineyard => {
                const p = document.createElement('p');
                p.className = 'text-xl md:text-2xl font-semibold text-gray-800 tracking-wide leading-relaxed';
                p.textContent = vineyard;
                vineyardsEl.appendChild(p);
            });

            const distractors = [];
            const otherVillages = villages.filter(v => v !== correctVillage);
            const shuffledDistractors = shuffle(otherVillages);
            
            for (let i = 0; i < 3; i++) {
                distractors.push(shuffledDistractors[i]);
            }

            const options = shuffle([...distractors, correctVillage]);
            optionsContainer.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'btn-option w-full bg-white border border-gray-300 text-gray-700 font-semibold p-4 rounded-lg shadow-sm hover:bg-gray-50 cursor-pointer';
                button.textContent = option.replace(/ AOP$/, "");
                button.dataset.optionValue = option;
                optionsContainer.appendChild(button);
            });
        }

        function handleOptionClick(event) {
            const button = event.target.closest('button.btn-option');
            if (!button || button.disabled) return;
            
            const selectedOption = button.dataset.optionValue;
            checkAnswer(selectedOption, button);
        }

        function checkAnswer(selectedOption, button) {
            const allButtons = optionsContainer.querySelectorAll('button');
            allButtons.forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.optionValue === correctVillage) {
                    btn.classList.add('correct');
                }
            });

            if (selectedOption === correctVillage) {
                score++;
                showFeedbackModal(true);
            } else {
                button.classList.add('incorrect');
                showFeedbackModal(false);
            }
            
            scoreEl.textContent = score;
        }
        
        function showFeedbackModal(isCorrect) {
            if (isCorrect) {
                feedbackTitle.textContent = "Correct!";
                feedbackTitle.className = "text-4xl font-bold title-font mb-4 text-green-600";
                feedbackText.textContent = "Excellent! You've nailed it.";
            } else {
                feedbackTitle.textContent = "Incorrect";
                feedbackTitle.className = "text-4xl font-bold title-font mb-4 text-red-600";
                feedbackText.innerHTML = `The correct village is <strong class="underline">${correctVillage.replace(/ AOP$/, "")}</strong>.`;
            }
            
            if (currentRound >= totalRounds) {
                continueButton.textContent = "See Results";
            } else {
                continueButton.textContent = "Next Round";
            }

            feedbackModal.classList.add('active');
            feedbackModalOverlay.classList.add('active');
        }

        function hideFeedbackModal() {
            feedbackModal.classList.remove('active');
            feedbackModalOverlay.classList.remove('active');
        }

        function advanceGame() {
            hideFeedbackModal();
            generateQuestion();
        }

        function endGame() {
            gameArea.classList.add('hidden');
            footerInfo.classList.add('hidden');
            finalScoreArea.classList.remove('hidden');
            
            const percentage = Math.round((score / totalRounds) * 100);
            finalScoreDisplay.textContent = `${score} / ${totalRounds}`;
            finalPercentageDisplay.textContent = `(${percentage}%)`;
            
            let message = '';
            if (percentage === 100) {
                message = "You are a true Burgundy Legend! Your knowledge is unparalleled. Keep playing to defend your title!";
            } else if (percentage >= 80) {
                message = "Excellent work! You have a deep understanding of Burgundy's vineyards. A true connoisseur!";
            } else if (percentage >= 60) {
                message = "Great job! You're well on your way to mastering the Côte d'Or. Keep practicing!";
            } else if (percentage >= 40) {
                message = "Solid effort! You've got a good foundation. A few more rounds and you'll be a pro.";
            } else {
                message = "A noble start! Burgundy is complex, but every expert starts somewhere. Keep exploring!";
            }
            finalMessage.textContent = message;
        }
        
        function populateStudyGuide() {
            studyContent.innerHTML = '';
            const sortedVillages = Object.keys(vineyardData).sort();

            for (const village of sortedVillages) {
                const villageData = vineyardData[village];
                const villageDiv = document.createElement('div');
                villageDiv.className = 'mb-6';
                
                const villageTitle = document.createElement('h3');
                villageTitle.className = 'text-2xl font-bold text-red-800 title-font border-b-2 border-red-800/20 pb-1 mb-3';
                villageTitle.textContent = village.replace(/ AOP$/, "");
                villageDiv.appendChild(villageTitle);

                const classifications = ["Grand Cru", "Premier Cru", "Lieux-dits"];
                classifications.forEach(classification => {
                    if (villageData[classification] && villageData[classification].length > 0) {
                        const classificationTitle = document.createElement('h4');
                        classificationTitle.className = 'text-lg font-semibold text-gray-700 mt-2 mb-1';
                        // Correctly handle pluralization
                        classificationTitle.textContent = classification === 'Lieux-dits' ? 'Lieux-dits' : classification + 's';
                        villageDiv.appendChild(classificationTitle);

                        const vineyardList = document.createElement('p');
                        vineyardList.className = 'text-gray-600 leading-relaxed';
                        vineyardList.textContent = villageData[classification].sort().join(', ');
                        villageDiv.appendChild(vineyardList);
                    }
                });
                
                studyContent.appendChild(villageDiv);
            }
        }

        // --- Event Listeners ---
        window.onload = () => {
            welcomeModal.classList.add('active');
            modalOverlay.classList.add('active');
        };

        startGameButton.addEventListener('click', () => {
            welcomeModal.classList.remove('active');
            modalOverlay.classList.remove('active');
            mainContent.classList.remove('hidden');
            initializeGame();
        });
        
        studyButton.addEventListener('click', () => {
            populateStudyGuide();
            studyModal.classList.add('active');
            studyModalOverlay.classList.add('active');
        });
        
        closeStudyButton.addEventListener('click', () => {
            studyModal.classList.remove('active');
            studyModalOverlay.classList.remove('active');
        });

        continueButton.addEventListener('click', advanceGame);
        playAgainButton.addEventListener('click', initializeGame);
        optionsContainer.addEventListener('click', handleOptionClick);
    </script>

</body>
</html>
